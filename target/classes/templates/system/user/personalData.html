<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>修改密码</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="/resources/layui/css/layui.css" media="all" />
    <link rel="stylesheet" href="/resources/css/public.css" media="all" />
    <link rel="stylesheet" href="/resources/css/index.css" media="all" />
    <style>
        .customStyle{
            margin:2px 0;
        }
        .customUserPhoto{
            padding: 0px 0 10px;
        }
        .imgPosition{
            position: relative;
            left: 50px;
            top: 0px;
            width: 125px;
            height:125px;
            border: 1px;
        }
        .imgPositionBtu{
            position: relative;
            left: 55px;
            top: 5px;
            width: 100px;
            height:40px;

        }
    </style>
</head>
<body>
<div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md3">
            <div class="layui-card">
                <div class="layui-card-header">个人资料</div>
                <div class="layui-card-body">
                    <div class="text-center customStyle">
<!--                        <div class="user-photo customUserPhoto" >-->
<!--                            <a class="img" title="我的头像" id="updateImgPath"><img src="/resources/images/face.jpg" class="userAvatar" style="width: 125px;height:125px"  ></a>-->
<!--                        </div>-->
                        <div class="layui-upload ">
                            <div class="layui-upload-list ">
                                <img class="layui-upload-img imgPosition userThumbImg" id="updateImgPath" th:src="'/file/showImageByPath?path='+${session.user.imgpath}">
                                <p id="demoText"></p>
                                <button type="button" class="layui-btn imgPositionBtu" align="center" id="uploadImg">修改头像</button>
                            </div>
                        </div>
                        <hr class="layui-bg-blue customStyle ">
                        <label class="layui-form-label required"><i class="layui-icon layui-icon-username"></i> 登录名称</label>
                        <label class="layui-form-label required" th:text="${session.user.loginname}"></label>
                        <hr class="layui-bg-blue customStyle">
                        <label class="layui-form-label required"><i class="layui-icon layui-icon-cellphone"></i>手机号码</label>
                        <label class="layui-form-label required" th:text="${session.user.mobile}"></label>
                        <hr class="layui-bg-blue customStyle">
                        <label class="layui-form-label required"><i class="layui-icon layui-icon-group"></i>所属部门</label>
                        <label class="layui-form-label required" th:text="${session.user.deptname}"></label>
                        <hr class="layui-bg-blue customStyle">
                        <label class="layui-form-label required"><i class="layui-icon layui-icon-senior"></i>邮箱地址</label>
                        <label class="layui-form-label required" th:text="${session.user.email}"></label>
                        <hr class="layui-bg-blue customStyle">
                        <label class="layui-form-label required"><i class="layui-icon layui-icon-date"></i>入职时间</label>
                        <label class="layui-form-label required" >[[${#dates.format(session.user.hiredate, 'yyyy-MM-dd')}]]</label>
                        <hr class="layui-bg-blue customStyle">

                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md9">
            <div class="layui-card">
                <div class="layui-card-header">基本资料</div>
                <div class="layui-card-body">
                    <div class="layui-tab">
                        <ul class="layui-tab-title">
                            <li class="layui-this">基本资料</li>
                            <li>修改密码</li>
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show">
                                <form class="layui-form" action="" id="dataFrm" lay-filter="dataFrm">
                                    <div class="layui-form-item">
                                            <label class="layui-form-label">用户名称:</label>
                                            <div class="layui-input-block">
                                                <input type="hidden" name="id" th:value="${session.user.id}">
                                                <input type="tel" name="name" readonly="readonly" th:value="${session.user.name}" lay-verify="required" autocomplete="off" class="layui-input">
                                            </div>
                                    </div>
                                    <div class="layui-form-item">
                                            <label class="layui-form-label">手机号码:</label>
                                            <div class="layui-input-block">
                                                <input type="text" name="mobile" th:value="${session.user.mobile}" lay-verify="phone" autocomplete="off" class="layui-input">
                                            </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">邮箱:</label>
                                        <div class="layui-input-block">
                                            <input type="text" name="email" th:value="${session.user.email}" lay-verify="email" placeholder="" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">单选框</label>
                                        <div class="layui-input-block">
                                            <input type="radio" name="sex" value="1" title="男" th:attr ="checked=${session.user.sex==1?true:false}">
                                            <input type="radio" name="sex" value="0" title="女" th:attr ="checked=${session.user.sex==0?true:false}">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button type="submit" class="layui-btn" lay-submit="" lay-filter="userData"><i class="layui-icon layui-icon-ok-circle"></i> 立即提交</button>
                                            <button type="reset" class="layui-btn layui-btn-warm"><i class="layui-icon layui-icon-refresh"></i>重置</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="layui-tab-item">
                                <form class="layui-form" action="">
                                    <div class="layui-form-item">
                                        <label class="layui-form-label"><i class="layui-icon layui-icon-password"></i>旧 密 码</label>
                                        <div class="layui-input-block">
                                            <input type="hidden" name="id" th:value="${session.user.id}">
                                            <input type="password" name="oldPassword" placeholder="请输入密码" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label"><i class="layui-icon layui-icon-password"></i>新 密 码</label>
                                        <div class="layui-input-block">
                                            <input type="password" name="newPassword" placeholder="请输入密码" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <div class="layui-form-item">
                                        <label class="layui-form-label"><i class="layui-icon layui-icon-password"></i>确认密码</label>
                                        <div class="layui-input-block">
                                            <input type="password" name="password" placeholder="请输入密码" autocomplete="off" class="layui-input">
                                        </div>
                                    </div>

                                    <div class="layui-form-item">
                                        <div class="layui-input-block">
                                            <button type="submit" class="layui-btn" lay-submit="" lay-filter="reUserPassword"><i class="layui-icon layui-icon-ok-circle"></i>立即提交</button>
                                            <button type="reset" class="layui-btn layui-btn-warm"><i class="layui-icon layui-icon-refresh"></i>重置</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--查看图片的弹出窗开始-->
<div style="display: none;padding: 5px" id="showGoodsImg">
        <div class="layui-form-item" id="dataGoodsImg">
            <div class="layui-input-block">
                <img class="layui-upload-img showThumbImg" style="border-bottom: 1px" width="470" height="440" th:src="'/file/showImageByPath?path='+${session.user.imgpath}" >
            </div>
        </div>
</div>
<script type="text/javascript" src="/resources/layui/layui.js"></script>
<script>
    layui.use(['jquery','form','layer','element','upload'],function(){
        var $=layui.jquery;
        var form=layui.form;
        var layer=layui.layer;
        var element = layui.element;
        var upload=layui.upload;


        //监听修改资料事件
        form.on('submit(userData)', function(data){
            $.post("/user/updateUserPersonData",data.field,function (res) {
                if(res.code===200){
                    layer.msg(res.msg);
                }else{
                    layer.msg(res.msg);
                }
            })
            return false;
        });

        //监听修改密码事件
        form.on('submit(reUserPassword)', function(data){
            //判断两次密码是否一样
            if(data.field.newPassword===data.field.password){
                $.post("/user/reUserPersonPassword",data.field,function (res) {
                    if(res.code===200){
                        layer.msg(res.msg);
                    }else{
                        layer.msg(res.msg);
                    }
                })
            }else{
                layer.msg("两次密码不一致");
            }
            return false;
        });
        /*
        * 解决单选按钮的回显问题
        *
        * */
        //方法一
        var name='[[${session.user.name}]]'
        var sex='[[${session.user.sex}]]'
        // $(document).ready(function(){
        //     form.val("dataFrm",{
        //         "name":name,
        //         "sex":sex
        //     });
        // })

        //普通图片上传
        var uploadInst = upload.render({
            elem: '#uploadImg',
            url: '/file/userUploadFile',
            acceptMime:'image/*',
            field:'mf',
            method : "post",  //此处是为了演示之用，实际使用中请将此删除，默认用post方式提交
            before: function(obj){
               //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#updateImgPath').attr('src', result); //图片链接（base64）
                });
            },
            done: function(res, index, upload){
                var path=res.path;
                $('.userThumbImg').attr('src','/file/showImageByPath?path='+path);
                $('.showThumbImg').attr("src",'/file/showImageByPath?path='+path);
                layer.msg(res.msg)
            }
            ,error: function(){
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function(){
                    uploadInst.upload();
                });
            }
        });

        //查看头像
        $("#updateImgPath").click(function () {
            mainIndex=layer.open({
                type:1,
                content:$("#showGoodsImg"),
                area:['650px','510px'],
                title:'查看可爱头像',
            });
        })
    })
</script>

</body>
</html>